<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Rest API Authentication Example</title>
        <!-- Bootstrap 4 CSS and custom CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
        <link rel="stylesheet" type="text/css" href="custom.css" />
    </head>
<body>
    <!-- jQuery & Bootstrap 4 JavaScript libraries -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- jQuery & Bootstrap 4 JavaScript libraries -->
    
    <!-- navbar -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">Скины Дота2</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="#" id='home'>Главная</a>
            </div>
            <div class="navbar-nav ml-auto">
                <a class="nav-item nav-link" href="#" id='korzina'>Корзина</a>
                <img src="" href="#" alt="Профиль" style="display: none; width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 10px;" id='profile_photo' />
                <a class="nav-item nav-link" href="#" id='update_account'>Профиль</a>
                <a class="nav-item nav-link" href="#" id='logout'>Выход</a>
                <a class="nav-item nav-link" href="#" id='login'>Вход</a>
                <!--span class="nav-item nav-link divider" id='cherta'>\</span-->
                <a class="nav-item nav-link" href="#" id='sign_up'>Регистрация</a>
            </div>
        </div>
    </nav>
    <!-- /navbar -->
     
    <!-- container -->
    <main role="main" class="container starter-template">

                <!-- where prompt / messages will appear -->
                <div id="response"></div>
                <!-- where main content will appear-->
                <div id="content"></div>
    </main>
    <!-- /container -->

    <!-- Модальное окно для добовления товара -->
    <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Добавление нового товара</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="addProductForm" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="productName">Название</label>
                            <input type="text" class="form-control" id="productName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Цена</label>
                            <input type="number" class="form-control" id="productPrice" name="price" required>
                        </div>
                        <div class="form-group">
                            <label for="productPhoto">Фотография товара</label>
                            <input type="file" class="form-control-file" id="productPhoto" name="path_photo">
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Категория</label>
                            <select class="form-control" id="productCategory" name="category_id">
                                <option value="1">Категория 1</option>
                                <option value="2">Категория 2</option>
                                <!-- Добавьте дополнительные категории здесь -->
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                        <button type="submit" class="btn btn-primary">Добавить товар</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Модальное окно для редактирования товара -->
    <div class="modal fade" id="editProductModal" tabindex="-1" role="dialog" aria-labelledby="editProductModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editProductModalLabel">Редактирование товара</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form id="editProductForm">
            <div class="modal-body">
              <!-- Скрытое поле для ID товара -->
              <input type="hidden" id="editProductId" name="id">
              <div class="form-group">
                <label for="editProductName">Название</label>
                <input type="text" class="form-control" id="editProductName" placeholder="" name="name" required>
              </div>
              <div class="form-group">
                <label for="editProductPrice">Цена</label>
                <input type="text" class="form-control" id="editProductPrice" placeholder="" name="price" required>
              </div>
              <!-- Добавьте другие поля по необходимости -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
              <button type="submit" class="btn btn-primary">Сохранить изменения</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Модальное окно для добавления категории -->
    <div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Добавить категорию</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addCategoryForm">
                        <div class="form-group">
                            <label for="categoryName">Название категории</label>
                            <input type="text" class="form-control" id="categoryName" placeholder="Введите название категории">
                        </div>
                        <button type="submit" class="btn btn-primary">Сохранить категорию</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Модальное окно для удаления категории -->
    <div class="modal fade" id="deleteCategoryModal" tabindex="-1" role="dialog" aria-labelledby="deleteCategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteCategoryModalLabel">Удалить категорию</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="deleteCategoryForm">
                        <div class="form-group">
                            <label for="categoryToDeleteId">ID категории для удаления</label>
                            <input type="number" class="form-control" id="categoryToDeleteId" placeholder="Введите ID категории" required>
                        </div>
                        <button type="submit" class="btn btn-danger">Удалить категорию</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        $(document).ready(function(){
        // show sign up / registration form
            $(document).on('click', '#sign_up', function(){
                var html = `
                    <h2>Sign Up</h2>
                    <form id='sign_up_form' enctype="multipart/form-data"> <!-- Добавлен атрибут enctype -->
                        <div class="form-group">
                            <label for="firstname">Имя</label>
                            <input type="text" class="form-control" name="firstname" id="firstname" required />
                        </div>
                        <div class="form-group">
                            <label for="lastname">Фамилия</label>
                            <input type="text" class="form-control" name="lastname" id="lastname" required />
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" name="email" id="email" required />
                        </div>
                        <div class="form-group">
                            <label for="password">Пароль</label>
                            <input type="password" class="form-control" name="password" id="password" required />
                        </div>
                        <div class="form-group">
                            <label for="role">Роль</label>
                            <select class="form-control" name="role" id="role" required>
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <!-- Скрытое поле для установки значения profile_photo -->
                        <input type="hidden" name="profile_photo" value="api/images/server/server-error.jpg" />
                       
                        <button type='submit' class='btn btn-primary'>Sign Up</button>
                    </form>
                    `;
                clearResponse();
                $('#content').html(html);
            });
            // trigger when registration form is submitted
            $(document).on('submit', '#sign_up_form', function(){
                // get form data
                var sign_up_form=$(this);
                var form_data=JSON.stringify(sign_up_form.serializeObject());
                // submit form data to api
                $.ajax({
                    url: "api/data/user/create_user.php",
                    type : "POST",
                    contentType : 'application/json',
                    data : form_data,
                    success : function(result) {
                        // if response is a success, tell the user it was a successful sign up & empty the input boxes
                        $('#response').html("<div class='alert alert-success'>Successful sign up. Please login.</div>");
                        sign_up_form.find('input').val('');
                    },
                    error: function(xhr, resp, text){
                        // on error, tell the user sign up failed
                        $('#response').html("<div class='alert alert-danger'>Unable to sign up. Please contact admin.</div>");
                    }
                });
                return false;
            });
        
            // show login form
            $(document).on('click', '#login', function(){
                showLoginPage();
            });
            // trigger when login form is submitted
            $(document).on('submit', '#login_form', function(e){
                e.preventDefault(); // Предотвратить стандартную отправку формы
            
                var login_form = $(this);
                var form_data = login_form.serializeObject();
            
                // отправить данные формы на сервер
                $.ajax({
                    url: "api/data/user/login.php",
                    type : "POST",
                    contentType : 'application/json',
                    data : JSON.stringify(form_data),
                    success : function(result){
                        // сохранить jwt в cookie
                        setCookie("jwt", result.jwt, 1);
            
                        // показать домашнюю страницу и сообщить пользователю об успешном входе
                        showHomePage();
                        $('#response').html("<div class='alert alert-success'>Successful login.</div>");
                        
                        // декодировать JWT и обновить фото профиля
                        var jwt_data = parseJwt(result.jwt);
                        if(jwt_data.data.profile_photo) {
                            $('#profile_photo').attr('src',jwt_data.data.profile_photo);
                        }
                    },
                    error: function(xhr, resp, text){
                        // в случае ошибки сообщить пользователю о неудачной попытке входа
                        $('#response').html("<div class='alert alert-danger'>Login failed. Email or password is incorrect.</div>");
                        login_form.find('input').val('');
                    }
                });
            });
            // функция для декодирования JWT
            function parseJwt(token) {
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
            
                return JSON.parse(jsonPayload);
            };
        
            // show home page
            $(document).on('click', '#home', function(){
                showHomePage();
                clearResponse();
            });
            $(document).on('click', '#korzina', function(){
                showkorzinaPage();
            });
            // show update account form
            $(document).on('click', '#update_account', function(){
                showUpdateAccountForm();
            });
            // trigger when 'update account' form is submitted
            $(document).on('submit', '#update_account_form', function(){
                // handle for update_account_form
                var update_account_form=$(this);
                // validate jwt to verify access
                var jwt = getCookie('jwt');
                // get form data
                var update_account_form_obj = update_account_form.serializeObject()
                // add jwt on the object
                update_account_form_obj.jwt = jwt;
                // convert object to json string
                var form_data=JSON.stringify(update_account_form_obj);
                // submit form data to api
                var update_account_form = new FormData(this);
                update_account_form.append('jwt', jwt);
                
                $.ajax({
                        url: "api/update_user.php", // Укажите URL вашего API для обновления пользователя
                        type : "POST",
                        contentType: false,
                        processData: false,
                        data : update_account_form,
                        success : function(result) {
                            // Уведомление пользователя об успешном обновлении
                            $('#response').html("<div class='alert alert-success'>Account was updated.</div>");
                        },
                        error: function(xhr, resp, text){
                            console.log(resp, text);
                            // Уведомление пользователя об ошибке
                            $('#response').html("<div class='alert alert-danger'>Unable to update account. Please contact support.</div>");
                        }
                    });
                return false;
            });
            // logout the user
            $(document).on('click', '#logout', function(){
                showLoginPage();
                $('#response').html("<div class='alert alert-info'>You are logged out.</div>");
            });
                    
            // remove any prompt messages
            function clearResponse(){
                $('#response').html('');
            }
            
            // show login page
            function showLoginPage(){
                // remove jwt
                setCookie("jwt", "", 1);
                // login page html
                var html = `
                    <h2>Login</h2>
                    <form id='login_form'>
                        <div class='form-group'>
                            <label for='email'>Email Address</label>
                            <input type='email' class='form-control' id='email' name='email' placeholder='Enter email'>
                        </div>
                        <div class='form-group'>
                            <label for='password'>Пароль</label>
                            <input type='password' class='form-control' id='password' name='password' placeholder='Password'>
                        </div>
                        <button type='submit' class='btn btn-primary'>Login</button>
                    </form>
                    `;
                $('#content').html(html);
                clearResponse();
                showLoggedOutMenu();
            }
            
            // function to set cookie
            function setCookie(cname, cvalue, exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays*24*60*60*1000));
                var expires = "expires="+ d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }
        
            
            // if the user is logged out
            function showLoggedOutMenu(){
                // show login and sign up from navbar & hide logout button
                $("#login, #sign_up").show();
                $("#logout, #profile_photo").hide();
            }
            // if the user is logged in
            function showLoggedInMenu(){
                // hide login and sign up from navbar & show logout button
                $("#login, #cherta , #sign_up").hide();
                $("#logout, #profile_photo").show();
            }
        
            //<---------------------------------------------------------------------------------------Home Page--------------------------------------------------------------------------------------->
            // show home page
            function showHomePage(categoryId = '') {
                var jwt = getCookie('jwt');
                $.post("api/data/user/validate_token.php", JSON.stringify({ jwt:jwt })).done(function(result) {
                    var user = result.data;
                 
                    $('#content').load('homepage.html', function() {
                        if(user.role == 'admin') {
                            var adminHtml = `<div class="col-12 mb-3">
                                                <button type="button" class="btn btn-success" id="addProductBtn">Добавить товар</button>
                                                <button type="button" class="btn btn-success" id="addCategoryBtn">Добавить категорию</button>
                                                <button type="button" class="btn btn-danger" id="deleteCategoryBtn">Удалить категорию</button>
                                            </div>`;
                            $('#content').append(adminHtml);
                        }
                     
                        $('#filterForm').submit(function(e) {
                            e.preventDefault();
                            var selectedCategory = $('#categoryId').val();
                            showHomePage(selectedCategory);
                        });
                        $.ajax({
                            url: 'api/data/product/get_categories.php', // Путь к вашему серверному скрипту
                            type: 'GET',
                            success: function(categories) {
                                // Очищаем текущие опции и добавляем "Все категории"
                                var select = $('#categoryId');
                                select.empty().append($('<option>', {
                                    value: '',
                                    text: 'Все категории'
                                }));
                    
                                // Добавляем полученные категории в выпадающий список
                                categories.forEach(function(category) {
                                    select.append($('<option>', {
                                        value: category.id,
                                        text: category.name
                                    }));
                                });
                            },
                            error: function(xhr, status, error) {
                                console.error("Ошибка при получении категорий: ", error);
                            }
                        });
                        
                        getProducts(function(products) {
                            var productTemplate = $('#productTemplate').html();
                            var productsHtml = '';
                            if (products && products.length > 0) {
                                products.forEach(function(product) {
                                    var adminButtons = user.role == 'admin' ? 
                                        `<button type="button" class="btn btn-sm btn-outline-secondary edit-product-btn" data-product-id="${product.id}">Edit</button>
                                         <button type="button" class="btn btn-sm btn-outline-danger delete-product-btn" data-product-id="${product.id}">Delete</button>` : '';
                                   
                                    var productHtml = productTemplate
                                        .replace(/%path_photo%/g, product.path_photo)
                                        .replace(/%name%/g, product.name)
                                        .replace(/%description%/g, product.description)
                                        .replace(/%id%/g, product.id)
                                        .replace(/%adminButtons%/g, adminButtons)
                                        .replace(/%price%/g, product.price);
            
                                    productsHtml += productHtml;
                                });
                                $('#content').append('<div class="row">' + productsHtml + '</div>');
                            } else {
                                $('#content').append('<p>Товары не найдены.</p>');
                            }
                        }, categoryId);
                    });
            
                    showLoggedInMenu();
                })
                .fail(function(result){
                    showLoginPage();
                    $('#response').html("<div class='alert alert-danger'>Please login to access the home page.</div>");
                });
            }
            
            // Функция для получения товаров
            function getProducts(callback, categoryId = '') {
                // Подготовка данных для запроса
                var data = {};
                if (categoryId) {
                    data.categoryId = categoryId; // Добавляем categoryId в данные запроса, если он задан
                }
            
                $.ajax({
                    url: 'api/data/product/get_products.php', // Убедитесь, что адрес верный
                    type: 'GET',
                    data: data, // Передаем данные в запросе
                    dataType: 'json',
                    success: function(response) {
                        callback(response);
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка получения списка товаров: ", error);
                    }
                });
            }
            // Обработчик отправки формы фильтрации

            
            // Открытие модального окна категории
            $('body').on('click', '#addCategoryBtn', function() {
                // Открытие модального окна
                $('#categoryModal').modal('show');
            });
            // Обработка отправки формы категории
            $('#addCategoryForm').submit(function(event) {
                event.preventDefault(); // Предотвратить стандартную отправку формы
                var categoryName = $('#categoryName').val();
                var categoryDescription = $('#categoryDescription').val(); // Получаем описание категории
                
                // Проверка введенного названия и описания категории
                if (categoryName.trim() === '') {
                    alert('Пожалуйста, введите название категории.');
                    return;
                }
                
                // AJAX запрос для отправки названия и описания категории на сервер
                $.ajax({
                    url: 'api/data/product/add_category.php', // Укажите здесь URL серверного скрипта
                    type: 'POST',
                    data: {
                          name: categoryName // Данные, которые вы хотите отправить на сервер
                    },
                    success: function(response) {
                          // Обработка успешного ответа от сервера
                          alert('Категория успешно добавлена!');
                          showHomePage();
                    },
                    error: function(xhr, status, error) {
                          // Обработка ошибок при запросе
                          alert('Произошла ошибка при добавлении категории.');
                    }
                });
                
                // Закрыть модальное окно и очистить форму
                $('#categoryModal').modal('hide');
                $('#addCategoryForm')[0].reset();
            });
            // Открытие модального окна удаления категории
            $('body').on('click', '#deleteCategoryBtn', function() {
                // Открытие модального окна
                $('#deleteCategoryModal').modal('show');
            });
            // Обработка отправки формы удаления категории
            $('#deleteCategoryForm').submit(function(event) {
                event.preventDefault();
                var categoryId = $('#categoryToDeleteId').val();
                $.ajax({
                    url: 'api/data/product/delete_category.php',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ id: categoryId }),
                    success: function(response) {
                       alert('Категория успешно удалена!'); // Показываем сообщение об успехе
                        $('#deleteCategoryModal').modal('hide'); // Закрываем модальное окно
                        showHomePage();
                    },
                    error: function(xhr, status, error) {
                        // Если ошибка не связана с JSON-ответом, используйте xhr.responseText
                        var errorMessage = xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText;
                        alert("Ошибка: " + errorMessage); // Показываем сообщение об ошибке
                    }
                });
            });
            
            
            // Функция для открытия модального окна редактирования товара и заполнения его данными
            function editProductModal(productId) {
                $.ajax({
                    url: 'api/data/product/get_product.php', // Путь к вашему скрипту, который возвращает данные о товаре
                    type: 'GET',
                    dataType: 'json', // Указываем, что ожидаем ответ в формате JSON
                    data: { id: productId },
                    success: function(productData) {
                        // Установка значений placeholder данными о товаре
                        $('#editProductName').attr('placeholder', productData.name);
                        $('#editProductPrice').attr('placeholder', productData.price);
                        
                        // Также установите фактические значения, если хотите, чтобы поля были заполнены
                        $('#editProductId').val(productId);
                        $('#editProductName').val(productData.name);
                        $('#editProductPrice').val(productData.price);
                        
                        // Открытие модального окна
                        $('#editProductModal').modal('show');
                    },
                    error: function(xhr, status, error) {
                        // Обработка ошибок
                        console.error("Ошибка получения данных о товаре: ", error);
                    }
                });
            }
            // Обработчик нажатия на кнопку редактирования товара
            $(document).on('click', '.edit-product-btn', function() {
                var productId = $(this).data('product-id');
                editProductModal(productId); // Вызов функции для редактирования товара
            });
            $('#editProductForm').submit(function(e) {
                e.preventDefault(); // Предотвращаем стандартное поведение формы
        
                var formData = $(this).serialize(); // Сериализуем данные формы
        
                // Отправляем данные на сервер через AJAX
                $.ajax({
                    url: 'api/data/product/update_product.php', // Укажите здесь правильный путь к вашему скрипту обновления продукта
                    type: 'POST',
                    dataType: 'json',
                    data: formData,
                    success: function(response) {
                        // Здесь вы можете обработать ответ от сервера после обновления продукта
                        $('#editProductModal').modal('hide'); // Закрываем модальное окно
                        // Здесь может быть код для обновления данных на странице
                        showHomePage();
                    },
                    error: function(xhr, status, error) {
                        // Обработка ошибок при отправке данных
                        console.error("Ошибка обновления продукта: ", error);
                    }
                });
            });
            
            // Обработчик нажатия на кнопку добовления товара
            $('body').on('click', '#addProductBtn', function() {
                // Очистка формы перед открытием модального окна
                $('#addProductForm')[0].reset();
                var select = $('#productCategory');
                select.empty();
        
                // Добавляем AJAX запрос для получения категорий
                $.ajax({
                    url: 'api/data/product/get_categories.php', // Путь к вашему серверному скрипту
                    type: 'GET',
                    success: function(categories) {
                        // Добавляем полученные категории в выпадающий список
                        categories.forEach(function(category) {
                            select.append($('<option>', {
                                value: category.id,
                                text: category.name
                            }));
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка при получении категорий: ", error);
                    }
                });
                // Открытие модального окна
                $('#addProductModal').modal('show');
            });
            $('#addProductForm').submit(function(e) {
                e.preventDefault();
                var formData = new FormData(this);
            
                $.ajax({
                    url: 'api/create_product.php', // Путь к скрипту создания товара
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        console.log(response);
                        // Обработка успешного добавления товара
                        $('#addProductModal').modal('hide'); // Закрытие модального окна
                        // Обновление списка товаров на странице
                        showHomePage();
                    },
                    error: function(xhr, status, error) {
                        // Обработка ошибок при отправке данных
                        console.error("Ошибка добавления товара: ", error);
                    }
                });
            });
            
            // Добавление обработчика событий для кнопок удаления товара
            $(document).on('click', '.delete-product-btn', function() {
                var productId = $(this).data('product-id');
                if (confirm('Вы уверены, что хотите удалить этот товар?')) {
                    $.ajax({
                        url: 'api/data/product/delete_product.php', // Путь к вашему скрипту удаления продукта
                        type: 'POST', // Или 'DELETE', если ваш API поддерживает этот метод
                        data: { id: productId },
                        success: function(response) {
                            // Товар успешно удален, обновляем список товаров
                            showHomePage();
                        },
                        error: function(xhr, status, error) {
                            // Обработка ошибок при удалении товара
                            console.error("Ошибка при удалении товара: ", error);
                        }
                    });
                }
            });
            
            //<---------------------------------------------------------------------------------------Home Page--------------------------------------------------------------------------------------->
        
            //<---------------------------------------------------------------------------------------Korzina Page--------------------------------------------------------------------------------------->
            // show korzina page
            function showkorzinaPage() {
                // validate jwt to verify access
                var jwt = getCookie('jwt');
                $.post("api/data/user/validate_token.php", JSON.stringify({ jwt:jwt })).done(function(result) {
                    // if valid, show custom content based on user role
                    var user = result.data; // предполагаем, что результат содержит данные пользователя
                    var html = '';
            
                    // Предположим, что у вас есть функция getProducts, которая делает AJAX-запрос к API и возвращает товары
                    getProducts(function(products) {
                        // Начало сетки карточек
                        html += '<div class="row">';
            
                        // Перебор товаров и создание карточки для каждого
                        products.forEach(function(product) {
                            html += `
                                <div class="col-md-4">
                                    <div class="card mb-4 shadow-sm">
                                        <img src="${product.path_photo}" class="card-img-top" alt="${product.name}">
                                        <div class="card-body">
                                            <h5 class="card-title">${product.name}</h5>
                                            <p class="card-text">${product.description}</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="btn-group">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
                                                </div>
                                                <small class="text-muted">${product.price}</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
            
                        // Закрытие сетки карточек
                        html += '</div>';
            
                        // Вставка HTML на страницу
                        $('#content').html(html);
                    });
            
                    showLoggedInMenu();
                });
            }
            //<---------------------------------------------------------------------------------------Korzina Page--------------------------------------------------------------------------------------->
            
            
            // get or read cookie
            function getCookie(cname){
                var name = cname + "=";
                var decodedCookie = decodeURIComponent(document.cookie);
                var ca = decodedCookie.split(';');
                for(var i = 0; i <ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' '){
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }
            function showUpdateAccountForm(){
                // validate jwt to verify access
                var jwt = getCookie('jwt');
                $.post("api/data/user/validate_token.php", JSON.stringify({ jwt:jwt })).done(function(result) {
                    // if response is valid, put user details in the form
                    var html = `
                        <h2>Update Account</h2>
                        <form id='update_account_form' enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="firstname">Имя</label>
                                <input type="text" class="form-control" name="firstname" id="firstname" required value="${result.data.firstname}" />
                            </div>
                            <div class="form-group">
                                <label for="lastname">Фамилия</label>
                                <input type="text" class="form-control" name="lastname" id="lastname" required value="${result.data.lastname}" />
                            </div>
                            <div class="form-group">
                                <label for="password">Пароль</label>
                                <input type="password" class="form-control" name="password" id="password" />
                            </div>
                            <div class="form-group">
                                <label for="profile_photo">Фото профиля</label>
                                <input type="file" class="form-control" name="profile_photo" id="profile_photo" />
                            </div>
                            <button type='submit' class='btn btn-primary'>
                                Save Changes
                            </button>
                        </form>
                    `;
                    clearResponse();
                    $('#content').html(html);
                })
                // on error/fail, tell the user he needs to login to show the account page
                .fail(function(result){
                    showLoginPage();
                    $('#response').html("<div class='alert alert-danger'>Please login to access the account page.</div>");
                });
            }
            
            // function to make form values to json format
            $.fn.serializeObject = function(){
                var o = {};
                var a = this.serializeArray();
                $.each(a, function() {
                    if (o[this.name] !== undefined) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });
                return o;
            };
        });

    </script>
    
</body>
</html>